BITS 32
EXTERN interrupt_handler
global idt_0

%macro no_error 1
idt_%1:
    push 0
    push %1
    jmp common_interrupt_handler
%endmacro
%macro error 1
idt_%1:
    push %1
    nop
    nop
    jmp common_interrupt_handler
%endmacro

common_interrupt_handler:
    pushad
    mov eax, cr2
    push eax
    call interrupt_handler
    add esp, 4 ; ignore cr2 
    popad
    add esp, 8 ; pop handler number and error code
    iretd

no_error 0
no_error 1
no_error 2
no_error 3
no_error 4
no_error 5
no_error 6
no_error 7
error 8
no_error 9
error 10
error 11
error 12
error 13
error 14
no_error 15
no_error 16
no_error 17
no_error 18
no_error 19
no_error 20
no_error 21
no_error 22
no_error 23
no_error 24
no_error 25
no_error 26
no_error 27
no_error 28
no_error 29
no_error 30
no_error 31
no_error 32
no_error 33
no_error 34
no_error 35
no_error 36
no_error 37
no_error 38
no_error 39
no_error 40
no_error 41
no_error 42
no_error 43
no_error 44
no_error 45
no_error 46
no_error 47
no_error 48
no_error 49
no_error 50
no_error 51
no_error 52
no_error 53
no_error 54
no_error 55
no_error 56
no_error 57
no_error 58
no_error 59
no_error 60
no_error 61
no_error 62
no_error 63
no_error 64
no_error 65
no_error 66
no_error 67
no_error 68
no_error 69
no_error 70
no_error 71
no_error 72
no_error 73
no_error 74
no_error 75
no_error 76
no_error 77
no_error 78
no_error 79
no_error 80
no_error 81
no_error 82
no_error 83
no_error 84
no_error 85
no_error 86
no_error 87
no_error 88
no_error 89
no_error 90
no_error 91
no_error 92
no_error 93
no_error 94
no_error 95
no_error 96
no_error 97
no_error 98
no_error 99
no_error 100
no_error 101
no_error 102
no_error 103
no_error 104
no_error 105
no_error 106
no_error 107
no_error 108
no_error 109
no_error 110
no_error 111
no_error 112
no_error 113
no_error 114
no_error 115
no_error 116
no_error 117
no_error 118
no_error 119
no_error 120
no_error 121
no_error 122
no_error 123
no_error 124
no_error 125
no_error 126
no_error 127
no_error 128
no_error 129
no_error 130
no_error 131
no_error 132
no_error 133
no_error 134
no_error 135
no_error 136
no_error 137
no_error 138
no_error 139
no_error 140
no_error 141
no_error 142
no_error 143
no_error 144
no_error 145
no_error 146
no_error 147
no_error 148
no_error 149
no_error 150
no_error 151
no_error 152
no_error 153
no_error 154
no_error 155
no_error 156
no_error 157
no_error 158
no_error 159
no_error 160
no_error 161
no_error 162
no_error 163
no_error 164
no_error 165
no_error 166
no_error 167
no_error 168
no_error 169
no_error 170
no_error 171
no_error 172
no_error 173
no_error 174
no_error 175
no_error 176
no_error 177
no_error 178
no_error 179
no_error 180
no_error 181
no_error 182
no_error 183
no_error 184
no_error 185
no_error 186
no_error 187
no_error 188
no_error 189
no_error 190
no_error 191
no_error 192
no_error 193
no_error 194
no_error 195
no_error 196
no_error 197
no_error 198
no_error 199
no_error 200
no_error 201
no_error 202
no_error 203
no_error 204
no_error 205
no_error 206
no_error 207
no_error 208
no_error 209
no_error 210
no_error 211
no_error 212
no_error 213
no_error 214
no_error 215
no_error 216
no_error 217
no_error 218
no_error 219
no_error 220
no_error 221
no_error 222
no_error 223
no_error 224
no_error 225
no_error 226
no_error 227
no_error 228
no_error 229
no_error 230
no_error 231
no_error 232
no_error 233
no_error 234
no_error 235
no_error 236
no_error 237
no_error 238
no_error 239
no_error 240
no_error 241
no_error 242
no_error 243
no_error 244
no_error 245
no_error 246
no_error 247
no_error 248
no_error 249
no_error 250
no_error 251
no_error 252
no_error 253
no_error 254
no_error 255
